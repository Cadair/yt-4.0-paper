<!DOCTYPE html>
<html>
<head>
<!-- Load Paper.js, custom JS parser, and D3 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.7.0/d3.min.js" integrity="sha512-cd6CHE+XWDQ33ElJqsi0MdNte3S+bQY819f7p3NUHgwQQLXSKjE4cPZTeGNI+vaxZynk1wVU3hoHmow3m089wA==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/acorn/8.2.1/acorn.min.js" integrity="sha512-SaR3AskCC6XMUHYTuq+O7Pat3lTYepJeW/yaMA1nXl8y6i2B5F1NpkJ/qM5RcXcL9MQ8VOdGvvww7Dp7rDR3aw==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.15/paper-full.min.js" integrity="sha512-ovjLI1ZcZe6bw+ImQ21r+sv8q/Vwob2kq7tFidK6E1LWfi0T4uobbmpfEU1//a9h9o5Kkt+MnMWf6rWlg0EiMw==" crossorigin="anonymous"></script>
<script type="text/javascript">
window.globals = {};

const xMargin = 40;
const yMargin = 40;
const width = 300;
const height = 300;
const xScale = d3.scaleLinear().domain([0, 1.0]).range([xMargin, width - xMargin]);
const yScale = d3.scaleLinear().domain([0, 1.0]).range([height - yMargin, yMargin]);
const colors = d3.scaleOrdinal(d3.schemeAccent);
window.globals.cellColor = d3.scaleSequential(d3.interpolateViridis);

window.globals.setupPlots = function() {
    const svg = d3.select("#plots")
        .attr("width", width)
        .attr("height", height);
    svg.append("g").attr("transform", "translate(0, " + (height - yMargin) + ")")
        .call(d3.axisBottom(xScale));
    svg.append("g").attr("transform", "translate(" + xMargin + ", 0)")
        .call(d3.axisLeft(yScale));
}

window.globals.updateRays = function() {
    if(window.globals.plane === undefined) return;
    d3.select("#plots")
        .selectAll("g.rayLines")
        .data(window.globals.plane.rays)
        .join("g")
        .attr("stroke", (d, i) => colors(i + 1))
        .attr("class", "rayLines")
        .selectAll("line")
        .data(d => d.data)
        .join("line")
        .attr("fill", "none")
        .attr("stroke-width", 1.5)
        .attr("x1", s => xScale(s.t0))
        .attr("x2", s => xScale(s.t1))
        .attr("y1", s => yScale(s.startTotal))
        .attr("y2", s => yScale(s.endTotal));
}
</script>
<script type="text/paperscript" canvas="vrFigure" src="vr-figure.js"></script>
</head>
<style>
html,
body {
    height: 100%;
}

/* Scale canvas with resize attribute to full size */
canvas[resize] {
    width: 80%;
    height: 100%;
}
</style>
<body>
    <canvas id="vrFigure" resize="true" hidpi="true"></canvas>
    <svg id="plots"></svg>
</body>
</html>
